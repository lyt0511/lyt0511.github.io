var $site_common_tag,$site_common_tag_name,dataSubmitTags=[],dataTags=[];!function(i){(e={tablet:-1!=(e=window.navigator.userAgent.toLowerCase()).indexOf("windows")&&-1!=e.indexOf("touch")&&-1==e.indexOf("tablet pc")||-1!=e.indexOf("ipad")||-1!=e.indexOf("android")&&-1==e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("tablet")||-1!=e.indexOf("kindle")||-1!=e.indexOf("silk")||-1!=e.indexOf("playbook"),phone:-1!=e.indexOf("windows")&&-1!=e.indexOf("phone")||-1!=e.indexOf("iphone")||-1!=e.indexOf("ipod")||-1!=e.indexOf("android")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("blackberry"),crawler:-1!=e.indexOf("googlebot")||-1!=e.indexOf("baiduspider")||-1!=e.indexOf("bingbot")||-1!=e.indexOf("yeti")||-1!=e.indexOf("naverbot")||-1!=e.indexOf("yahoo")||-1!=e.indexOf("tumblr")||-1!=e.indexOf("livedoor")||-1!=e.indexOf("yandexbot")||-1!=e.indexOf("ahrefsbot")||-1!=e.indexOf("icc-crawler")||-1!=e.indexOf("steeler")||-1!=e.indexOf("wisewebcrawler"),any:!1}).tablet||e.phone||(e.any=!0);var r=window.BCMS={ua:{any:e.any,tablet:e.tablet,phone:e.phone,crawler:e.crawler},ip:"dragonball",site:"jp",token:i('meta[name="token"]').attr("content"),region:i('meta[name="region"]').attr("content")};"en"==i("html").attr("lang")?r.site="en":"fr"==i("html").attr("lang")?r.site="fr":"de"==i("html").attr("lang")?r.site="de":"es"==i("html").attr("lang")&&(r.site="es"),r.api_url=/*! cmsapi-start */'//cmsapi-frontend.dragon-ball-official.com/site/api'/*! cmsapi-end */;var e=window.matchMedia("screen and (max-width: 767px)");function t(e){e.matches?r.vs="sm":r.vs="lg"}e.addListener(t),t(e),sanitaizeFunc={encode:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},decode:function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&")}},callApiFunc=function(e,t,n){var a=r.api_url+e.api,s={};s.token=r.token,s.site=r.site,s.ip=r.ip,void 0!==t&&(t=JSON.stringify(t),s.data=t),e.start&&(s.start=e.start),e.limit&&(s.limit=e.limit),e.mode&&(s.mode=e.mode),e.sort&&(s.sort=e.sort),i.ajax({url:a,crossDomain:!0,xhrFields:{withCredentials:!0},type:"GET",dataType:"JSON",cache:!1,scriptCharset:"utf-8",data:s}).done(function(e,t,a){void 0!==n&&n(e)}).fail(function(e,t,a){})}}(jQuery),function(w){var o="setLoadmore";w.fn[o]=function(e){if(!this.length)return!1;var y=w.extend({selectors:{btn:".js-setLoadmore__btn",target:".js-setLoadmore__target",templete:".js-setLoadmore__templete",form:".js-setLoadmore__form",freeword:".js-setLoadmore__freeword",tags:".js-setLoadmore__tags",sitebtn:".js-setLoadmore__site",paging:".js-setPagenation",pagingBtn:".js-setPagenation__btn",pagingHead:".js-setPagenation__head",pagingLast:".js-setPagenation__last",pagingPrev:".js-setPagenation__prev",pagingNext:".js-setPagenation__next",pagingTarget:".js-setPagenation__target",pagingTemplete:".js-setPagenation__templete"},classNames:{active:"active",all:"is-all",processing:"is-processing",disable:"is-disable",noresult:"noresult",first:"is-first",init:"is-init",hidden:"is-hidden",from:"is-from",year:"is-year"}},e);this.each(function(){return this[o+"Processed"]||(b=w(this),t=b.find(y.selectors.btn),a=b.find(y.selectors.sitebtn),l=b.find(y.selectors.target),c=b.find(y.selectors.templete),u=b.find(y.selectors.paging),n=b.find(y.selectors.form),s=n.find(y.selectors.freeword),n.find(y.selectors.tags),r=function(){var e={api:{api:"/dragonball/Article/list",start:b.data("start")||0,limit:b.data("limit")||0,site:BCMS.site},data:{},status:b.data("status")||"refine"};return b.data("sort")&&(e.api.sort=b.data("sort")),b.data("site")&&(e.api.site=b.data("site")),b.data("category")&&(e.data.category=b.data("category")),b.data("subcategory")&&(e.data.subcategory=b.data("subcategory")),b.data("brand")&&(e.data.brand=b.data("brand")),b.data("year")&&(e.data.year=b.data("year")),b.data("month")&&(e.data.month=b.data("month")),b.data("title")&&(e.data.title=b.data("title")),b.data("tag")&&(e.data.tag=b.data("tag")),b.data("start-date")&&(e.data.target_start_date=b.data("start-date")),b.data("end-date")&&(e.data.target_end_date=b.data("end-date")),e},i(),makeArrayParams=function(e,t){e.hasClass(y.classNames.active)?b.data(t,_.without(b.data(t),e.data(t)[0])):(b.removeData(t),b.removeAttr("data-"+t),b.data(t,_.union(b.data(t),e.data(t)))),0!=b.data(t).length&&!e.hasClass(y.classNames.all)||(b.removeData(t),b.removeAttr("data-"+t)),"brand"==t&&w("#schedule")[0]&&(t="",t=b.data("brand")&&b.data("brand").length<5?"?b="+encodeURIComponent(b.data("brand")):"./",window.history.replaceState(null,null,t))},buttonActive=function(e){e.on("click",function(){w(this).data("category")&&makeArrayParams(w(this),"category"),w(this).data("subcategory")&&makeArrayParams(w(this),"subcategory"),w(this).data("brand")&&makeArrayParams(w(this),"brand"),w(this).data("year")&&b.data("year",w(this).data("year")),w(this).data("month")&&b.data("month",w(this).data("month")),""!=s.val()&&b.data("title",s.val()),w(this).data("from")&&(w(this).removeData("period"),b.removeData("end-date"),b.data("start-date",moment(w(this).data("from")).toISOString())),w(this).data("period")&&(w(this).removeData("from"),b.data("start-date",moment(w(this).data("period")).toISOString()),b.data("end-date",moment(w(this).data("period")).endOf("month").toISOString())),w(this).data("start")?b.data("start",w(this).data("start")):b.removeData("start"),w(this).data("status")&&b.data("status",w(this).data("status")),i(),b.addClass(y.classNames.processing)})},buttonActive(t),makeTextSearch=function(e){if(!e.length)return!1;var t=e.find(y.selectors.freeword);e.on("submit",function(){return e.hasClass(y.classNames.first)&&(e.removeClass(y.classNames.first),""==t.val())?b.data("title",t.val()):b.data("title")!=t.val()&&(b.data("title",t.val()),b.removeData("start"),i(),b.addClass(y.classNames.processing)),!1})},makeTextSearch(n),sitebtnActive=function(e){e.on("change",function(){w(this).prop("checked")?b.addClass("region-show"):b.removeClass("region-show"),w("html, body").animate({scrollTop:0},500,"swing")})},sitebtnActive(a),makeTagSearch=function(){w(".js-tag-suggest").on("selected",function(){var e=w(this),t=e.closest(".keywords-text"),a=t.find(".keywords-inner");e.closest(".js-setLoadmore__form").length||(a=t.find(".keywords-box"));var n,s=e.val();e.closest(".js-setLoadmore__form").length&&($site_common_tag.forEach(function(e){e.name==s&&(n=e.code)}),t='<span class="select-tag" data-tag="'+n+'">'+s+'<b class="tag-remove">✖</b></span>',dataTags.push(n),b.data("tag",dataTags),b.attr("data-tag",dataTags),b.removeData("start"),i(),b.addClass(y.classNames.processing),a.append(t).addClass("is-active"),e.val(""))}),w(document).on("click",".tag-remove",function(){var e=w(this),t=e.closest(".keywords-text"),a=t.find(".keywords-inner");e.closest(".js-setLoadmore__form").length||(a=t.find(".keywords-box"));var n=e.parent().data("tag");e.closest(".js-setLoadmore__form").length&&(dataTags.some(function(e,t){e==n&&dataTags.splice(t,1)}),b.data("tag",dataTags),b.attr("data-tag",dataTags),b.removeData("start"),i(),b.addClass(y.classNames.processing),e.parent().remove(),t.find(".select-tag").length||a.removeClass("is-active"))})},makePagenation=function(l){if(!l.length)return!1;var a,n,s=l.find(y.selectors.pagingTarget),i=l.find(y.selectors.pagingTemplete),e=b.data("total-count"),r=b.data("limit"),t=b.data("start"),c=Math.ceil(e/r),o=1,u=1;t&&0!==t&&(u=t/r+1);var d=!0,m=(c-1)*r,f=5;"sm"==BCMS.vs&&(f=5);var p=Math.floor(f/2),g=c-p,h=f,v=!1,_=!1;c<f&&(d=!1,h=c),refinePagenation=function(){a=1==u?0:(u-2)*r,n=u==c?m:u*r,f<c&&(_=!0,"sm"==BCMS.vs&&(f=4,p=Math.floor(f/2),g=c-p,h=f,f=3<=u?(v=!0,3):(v=!1,4),p=Math.floor(f/2),g=c-p,h=f,f=c-u<=1?(_=!1,4):(_=!0,3<=u?3:4),p=Math.floor(f/2),g=c-p,h=f),"lg"==BCMS.vs&&(v=4<=u,_=!(c-u<=2))),d&&(u<=p?(o=1,h=f):g<=u?(o=g-p,h=c,"sm"==BCMS.vs&&f<c&&c-u<=1&&(o+=1)):(o=u-p,h=u+p));for(var e={button:[],head:0,prev:a,next:n,last:m,current:u,lastNum:c,firstFlag:v,endFlag:_},t=o;t<=h;t++)e.button.push({start:(t-1)*r,text:t});s.html(i.render(e)).ready(function(){var e=l.find(y.selectors.pagingBtn),t=l.find(y.selectors.pagingHead),a=l.find(y.selectors.pagingLast),n=l.find(y.selectors.pagingPrev),s=l.find(y.selectors.pagingNext),i=l.find(y.selectors.btn),r=l.find("."+y.classNames.active),o=r.next(),d=r.prev();i.removeClass(y.classNames.disable),r.addClass(y.classNames.disable),1==Number(r.text())?(t.addClass(y.classNames.disable),n.addClass(y.classNames.disable),1==h&&i.addClass(y.classNames.disable)):Number(r.text())==c&&(s.addClass(y.classNames.disable),a.addClass(y.classNames.disable)),e.on("click",function(){u=Number(w(this).text()),refinePagenation()}),t.on("click",function(){u=1,refinePagenation()}),n.on("click",function(){u=Number(d.text()),refinePagenation()}),s.on("click",function(){u=Number(o.text()),refinePagenation()}),a.on("click",function(){u=c,refinePagenation()}),i.each(function(){return buttonActive(w(this)),this})})},refinePagenation()},(a=window.matchMedia("screen and (max-width: 767px)")).addListener(e),e(),this[o+"Processed"]=!0),this;function i(){if(!b.hasClass(y.classNames.processing)){if("unset"==b.data("delay"))return b.data("delay","disable"),0;var e=r();callApiFunc(e.api,e.data,function(e){if(b.data("total-count",e.data.total_count),0==e.data.total_count||!e.data.apiStatus)return b.addClass(y.classNames.noresult),b.removeClass(y.classNames.processing),!1;var i;b.removeClass(y.classNames.noresult),"jp"==BCMS.site?w.views.converters("date",function(e){return moment(e).format("YYYY.MM.DD")}):w.views.converters("date",function(e){return moment(e).format("DD.MM.YYYY")});var r={jp:["日","月","火","水","木","金","土"],ct:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]};w.views.converters("eventDate",function(e){var t,a,n,s=moment.unix(i).format("YYYYMMDD")!=moment.unix(e).format("YYYYMMDD")?(t=moment.unix(e).format("D"),n="",0==(a=moment.unix(e).format("d"))?n=" holiday":6==a&&(n=" saturday"),'<div class="date'+n+'">'+t+'<span class="week">'+r[BCMS.site][a]+"</span></div>"):'<div class="date none"></div>';return i=e,s}),w.views.converters("brEncode",function(e){return e.replace(/\r?\n/g,"<br>")});for(var t=0;t<e.data.article_list.length;t++){var a=e.data.article_list[t],n=!1;a.hasOwnProperty("regional_setting")&&a.regional_setting.hasOwnProperty("enabled")&&1==a.regional_setting.enabled&&(n=!0,a.regional_setting.hasOwnProperty("region_list")&&a.regional_setting.region_list.forEach(function(e){e==BCMS.region&&(n=!1)})),a.regionHide=n}for(t=0;t<e.data.article_list.length;t++){var s,o=[];(a=e.data.article_list[t]).hasOwnProperty("tags")&&a.tags.forEach(function(e){var t,a=e;$site_common_tag.some(function(e){if(e.code==a)return t=e.name,o.push(t),!0})}),a.dp_tags=o,a.dp_newdate=Math.round(Date.parse(a.dspdate)/1e3),a.hasOwnProperty("categories")&&("NEWS"==a.categories.name?s=a.title:"MOVIE"==a.categories.name&&(s=a.movie_title)),a.custom_title=s}var d={now:Math.round((new Date).getTime()/1e3),diff:86400};l.html(c.render(e.data.article_list,d)).hide().fadeIn(500),b.data("delay","disable"),"paging"!=b.data("status")?makePagenation(u):w(".movie-area").length||w(".videos-area").length?(d=(d=w(".news-area")).prev().offset().top+d.prev().outerHeight()-w("#header").outerHeight(),w("html, body").animate({scrollTop:d},500,"swing")):w("html, body").animate({scrollTop:0},500,"swing"),b.data("status","refine"),b.removeClass(y.classNames.processing)})}}function e(e){makePagenation(u)}var b,t,a,l,c,u,n,s,r})},w(".js-setLoadmore").setLoadmore(),siteBaseCall=function(){var e=BCMS.api_url;w.ajax({url:e+"/cmsbase/SiteCommon/get",crossDomain:!0,xhrFields:{withCredentials:!0},type:"GET",dataType:"JSON",cache:!1,scriptCharset:"utf-8",data:{token:BCMS.token,ip:BCMS.ip,site:BCMS.site}}).done(function(e,t,a){200==e.statusCode&&($site_common_tag=e.data.tag,$site_common_tag_name=$site_common_tag.map(function(e){return e.name}),tagSuggestSet(),w("#top").length&&(topRanking(),topNews(),topMovieSlider(),topMoviePickup()),w("#related-article-wrap").length&&detailRelatedArticle())}).fail(function(e,t,a){})},siteBaseCall(),tagSuggestSet=function(){w(".js-tag-suggest").MySuggest({msArrayList:$site_common_tag_name,msListCount:5})},topRanking=function(){var e=BCMS.api_url,d=Math.round(Date.now()/1e3);w.ajax({url:e+"/dragonball/Ranking/list",crossDomain:!0,xhrFields:{withCredentials:!0},type:"GET",dataType:"JSON",cache:!1,scriptCharset:"utf-8",data:{token:BCMS.token,ip:BCMS.ip,site:BCMS.site,type:1}}).done(function(e,t,a){var n=[];for(i in e.data.ranking_list){for(var s in e.data.ranking_list[i])if("publish"==e.data.ranking_list[i][s].publish_status&&d<e.data.ranking_list[i][s].enddate&&n.push(e.data.ranking_list[i][s]),4<=n.length)break;if(4<=n.length)break}for(var i=0;i<n.length;i++){var r=[],o=n[i];o.hasOwnProperty("tags")&&o.tags.forEach(function(e){var a=String(e);$site_common_tag.some(function(e){var t=String(e.code),e=String(e.name);if(t==a)return r.push(e),!0})}),o.dp_tags=r}"jp"==BCMS.site?w.views.converters("date",function(e){return moment(e).format("YYYY.MM.DD")}):w.views.converters("date",function(e){return moment(e).format("DD.MM.YYYY")}),w("#top-ranking").append(w(".js-top-ranking__template").render(n))}).fail(function(e,t,a){})},topNews=function(){var e=BCMS.api_url,t={category:["NEWS"]},t=JSON.stringify(t);w.ajax({url:e+"/dragonball/Article/list",crossDomain:!0,xhrFields:{withCredentials:!0},type:"GET",dataType:"JSON",cache:!1,scriptCharset:"utf-8",data:{token:BCMS.token,ip:BCMS.ip,site:BCMS.site,start:0,limit:20,data:t}}).done(function(e,t,a){for(var n=1,s=0;s<e.data.article_list.length;s++){var i=e.data.article_list[s],r=!1,o=!1;i.hasOwnProperty("regional_setting")&&i.regional_setting.hasOwnProperty("enabled")&&1==i.regional_setting.enabled&&(r=!0,n++,i.regional_setting.hasOwnProperty("region_list")&&i.regional_setting.region_list.forEach(function(e){e==BCMS.region&&(r=!1,n--)})),!r&&n<=2&&(o=!0,n++),i.regionHide=r,i.sizeFlag=o}for(s=0;s<e.data.article_list.length;s++){var d=[];(i=e.data.article_list[s]).hasOwnProperty("tags")&&i.tags.forEach(function(e){var t,a=e;$site_common_tag.some(function(e){if(e.code==a)return t=e.name,d.push(t),!0})}),i.dp_tags=d,i.dp_newdate=Math.round(Date.parse(i.dspdate)/1e3)}var l={now:Math.round((new Date).getTime()/1e3),diff:86400};"jp"==BCMS.site?w.views.converters("date",function(e){return moment(e).format("YYYY.MM.DD")}):w.views.converters("date",function(e){return moment(e).format("DD.MM.YYYY")});for(var c=[],u=0,s=0;s<e.data.article_list.length&&(0==(i=e.data.article_list[s]).regionHide&&(c.push(i),u++),!(5<=u));s++);w("#top-news").append(w(".js-top-news__template").render(c,l))}).fail(function(e,t,a){})},topMovieSlider=function(){var e=BCMS.api_url,t={category:["MOVIE"],pickup:0},t=JSON.stringify(t);w.ajax({url:e+"/dragonball/Article/list",crossDomain:!0,xhrFields:{withCredentials:!0},type:"GET",dataType:"JSON",cache:!1,scriptCharset:"utf-8",data:{token:BCMS.token,ip:BCMS.ip,site:BCMS.site,start:0,limit:10,data:t}}).done(function(e,t,a){for(var n,s=0;s<e.data.article_list.length;s++){var i=[],r=e.data.article_list[s];r.hasOwnProperty("tags")&&r.tags.forEach(function(e){var t,a=e;$site_common_tag.some(function(e){if(e.code==a)return t=e.name,i.push(t),!0})}),r.dp_tags=i;var o,d=r.movie_url;r.hasOwnProperty("movie_kind")&&"Youtube"==r.movie_kind&&(o=d,d="https://www.youtube-nocookie.com/embed/",o.match("youtu.be")?d+=o.replace(/.*\.be\/([^&]+).*/,"$1"):o.match("youtube.com/watch")?d+=o.replace(/.*v=([^&]+).*/,"$1"):d=o),r.custom_movie_url=d}Math.round((new Date).getTime()/1e3),"jp"==BCMS.site?w.views.converters("date",function(e){return moment(e).format("YYYY.MM.DD")}):w.views.converters("date",function(e){return moment(e).format("DD.MM.YYYY")}),w("#top-movie-slider").html(w(".js-top-movie-slider__template").render(e.data.article_list)),n="jp"==BCMS.site?document.querySelector(".movie-slide.swiper-container"):document.querySelector(".videos-slide.swiper-container"),movieCarousel=new Swiper(n,{navigation:{nextEl:".swiper-button-next2",prevEl:".swiper-button-prev2"},paginationClickable:!0,slidesPerView:1,centeredSlides:!0,slideShadows:!1,effect:"coverflow",threshold:10,autoplay:{delay:5e3,disableOnInteraction:!1},speed:500,loop:!0,coverflowEffect:{rotate:0,stretch:-2,depth:.04,modifier:1,slideShadows:!1},on:{init:function(){"jp"==BCMS.site?(w(".movie-contents .text-area p.text").textShortCut(),document.body.classList.add("movie-show"),document.querySelector(".movie-slide.swiper-container").classList.add("show")):(document.body.classList.add("videos-show"),document.querySelector(".videos-slide.swiper-container").classList.add("show"))}}}),("jp"==BCMS.site?w(".movie-popup"):w(".videos-popup")).modaal({type:"video",before_open:function(){movieCarousel.autoplay.stop()},after_close:function(){movieCarousel.autoplay.start()},close_text:""})}).fail(function(e,t,a){})},topMoviePickup=function(){var e=BCMS.api_url,t={category:["MOVIE"],pickup:1},t=JSON.stringify(t);w.ajax({url:e+"/dragonball/Article/list",crossDomain:!0,xhrFields:{withCredentials:!0},type:"GET",dataType:"JSON",cache:!1,scriptCharset:"utf-8",data:{token:BCMS.token,ip:BCMS.ip,site:BCMS.site,start:0,limit:2,data:t}}).done(function(e,t,a){for(var n=0;n<e.data.article_list.length;n++){var s=[],i=e.data.article_list[n];i.hasOwnProperty("tags")&&i.tags.forEach(function(e){var t,a=e;$site_common_tag.some(function(e){if(e.code==a)return t=e.name,s.push(t),!0})}),i.dp_tags=s,i.dp_newdate=Math.round(Date.parse(i.dspdate)/1e3)}var r={now:Math.round((new Date).getTime()/1e3),diff:86400};"jp"==BCMS.site?w.views.converters("date",function(e){return moment(e).format("YYYY.MM.DD")}):w.views.converters("date",function(e){return moment(e).format("DD.MM.YYYY")}),w("#top-movie-pickup").append(w(".js-top-movie-pickup__template").render(e.data.article_list,r))}).fail(function(e,t,a){})},detailRelatedArticle=function(){for(var e=BCMS.api_url,t=relatedPath,a=[],n=0;n<t.length;n++){var s={page:t[n]},s=JSON.stringify(s);a.push(w.ajax({async:!1,url:e+"/dragonball/Article/get",crossDomain:!0,xhrFields:{withCredentials:!0},type:"GET",dataType:"JSON",cache:!1,scriptCharset:"utf-8",data:{token:BCMS.token,ip:BCMS.ip,site:BCMS.site,data:s}}))}var d=1==a.length;w.when.apply(w,a).done(function(){for(var e=0,t=d?1:arguments.length,a=0;a<t;a++){var n,s=d?arguments[0]:void 0===(o=arguments[a])[0]?o:o[0],i=[],r=s.data.article;r.hasOwnProperty("tags")&&r.tags.forEach(function(e){var t,a=e;$site_common_tag.some(function(e){if(e.code==a)return t=e.name,i.push(t),!0})}),r.dp_tags=i,r.hasOwnProperty("categories")&&("NEWS"==r.categories.name?n=r.title:"MOVIE"==r.categories.name&&(n=r.movie_title)),r.custom_title=n;var o={now:Math.round((new Date).getTime()/1e3),diff:86400};"jp"==BCMS.site?w.views.converters("date",function(e){return moment(e).format("YYYY.MM.DD")}):w.views.converters("date",function(e){return moment(e).format("DD.MM.YYYY")}),r.hasOwnProperty("content")&&(w("#related-article").append(w(".js-related-article__template").render(s.data.article,o)),e+=1)}0===e&&w("#related-article-wrap").remove()})}}(jQuery),function(s){var i="setButtonCheck";s.fn[i]=function(e){if(!this.length)return!1;var n=s.extend({selectors:{btn:".js-setButtonCheck__btn"},classNames:{active:"active",all:"is-all",disable:"is-disable"}},e);this.each(function(){return this[i+"Processed"]||(e=s(this),t=e.find(n.selectors.btn),a=e.find("."+n.classNames.all),t.on("click",function(){s(this).hasClass(n.classNames.all)?(t.removeClass(n.classNames.active),a.addClass(n.classNames.active),a.addClass(n.classNames.disable)):(a.removeClass(n.classNames.active),a.removeClass(n.classNames.disable),s(this).hasClass(n.classNames.active)?s(this).removeClass(n.classNames.active):(t.removeClass(n.classNames.active),s(this).addClass(n.classNames.active))),e.find("."+n.classNames.active).length<1&&(a.addClass(n.classNames.active),a.addClass(n.classNames.disable)),s(this).find("a").length&&s(this).find("a").trigger("onClick")}),this[i+"Processed"]=!0),this;var e,t,a})},s(".js-setButtonCheck").setButtonCheck()}(jQuery),function(n){var s="setButtonRadio";n.fn[s]=function(e){if(!this.length)return!1;var a=n.extend({selectors:{btn:".js-setButtonRadio__btn"},classNames:{active:"active",disable:"is-disable"}},e);this.each(function(){return this[s+"Processed"]||(e=n(this),(t=e.find(a.selectors.btn)).on("click",function(){t.removeClass(a.classNames.active),t.removeClass(a.classNames.disable),n(this).addClass(a.classNames.active),n(this).addClass(a.classNames.disable)}),this[s+"Processed"]=!0),this;var e,t})},n(".js-setButtonRadio").setButtonRadio()}(jQuery),function(g){function h(e,t){var a=0;return e.order<t.order&&(a=1),e.order<t.order?-1:a}g.fn.setEnq=function(e){if(!this.length)return!1;var _=g.extend({selectors:{roots:"#enq.js-setEnq"},complete:{html:""},url:{current:location.href},enquete:{id:""},validations:[]},e),a=BCMS.site,n=BCMS.api_url;function s(e){return(e=g(e).attr("maxlength")-g(e).val().length)<0?0:e}function f(t,a,n){g.getJSON("/assets/json/enqMessages.json",e=>{e=e.btnHome,"jsrender"===t?g(a).html(g(".js-enq__template").render({message:_.complete.html,btnHome:e,html:"comp",_id:n})):g(".text-area.form-enquete.enquete-"+n).html(_.complete.html+'<div class="btn"><a href="/">'+e+"</a></div>")})}function i(r){g(_.selectors.roots).find('input[type="submit"]').each((e,t)=>{g(t).prop("disabled",!1)}),g("[id^=err_answer]").each(function(e,t){g(t).html(""),g(t).addClass("hide")}),g.getJSON("/assets/json/enqMessages.json",i=>{Object.keys(r).forEach(e=>{var t=r[e];if(void 0===t.question_id)return!1;var a=("00000"+t.question_id).slice(-5),n="#err_answer"+a,s="ms"+t.errorCode;(e=g(n).html()).length&&(e+="<br/>"),i[s]&&300!=t.errorCode&&(e+=i[s]),i[s]&&300==t.errorCode&&(t=Array.isArray(t.answer)?"checkbox":Number.isInteger(t.answer)?"radio":"text",e+=i[s][t]),a=_.validations[a],e=e.replace("%n",a.ans_strings_max),g(n).html(e),g(n).removeClass("hide")});var e=g('[id^="err_answer"]:not(.hide):first').parent(),t=g(e).offset().top,e=g("#header").outerHeight();g("html, body").animate({scrollTop:t-e},500,"swing")})}function p(a,n){g.getJSON("/assets/json/enqMessages.json",e=>{var t=e["ms"+n],e=e.btnBk,e='<div class="entry-article"><div class="entry-hd-area"><div class="category-area"><br><br><br><br><br></div></div><div class="text-area form-enquete"><p class="read">'+t+'</p><div class="btn"><a href="'+a+'">'+e+"</a></div></div></div>";g(".news-contents").addClass("error"),g(".news-contents").html(e)})}g(_.selectors.roots).each((e,m)=>{var t=g(m).data("enq-id"),t=JSON.stringify({_id:t,region:a});g.ajax({url:n+"/dragonball/Enquete/detail",crossDomain:!0,xhrFields:{withCredentials:!0},type:"GET",dataType:"JSON",cache:!1,scriptCharset:"utf-8",data:{token:BCMS.token,ip:BCMS.ip,site:BCMS.site,data:t}}).done(function(e,t,a){let n=!1;try{if(200!==e.statusCode)return void p(_.url.current,statusCode);!0!==e.data.apiStatus&&(n=!0);var s=e.data.enquete_detail.enquete.lng,i=e.data.enquete_detail.enquete.enddate[s],r=(new Date).getTime()/1e3,o=e.data.enquete_detail.enquete_manage.name,d=e.data.enquete_detail.enquete_manage._id;if(_.enquete.id=d,i<r)return void g(m).html(g(".js-enq__template").render({title:o,html:!1}))}catch(e){n=!0}if(n||!0!==e.data.apiStatus)p(_.url.current,"Other");else{_.complete.html=e.data.enquete_detail.enquete.complete_text[s];for(var l="enquete-"+d,c=document.cookie.split(";"),u=0;u<c.length;u++)if(!c[u].trim().indexOf(l))return void f("jsrender",m,d);var o=e.data.enquete_detail.enquete_manage.name,i=e.data.enquete_detail.enquete_manage.enquete_type,r=e.data.enquete_detail.enquete_manage.region,e=e.data.enquete_detail.questiton,v=[];e.sort(h),e.forEach(e=>{var t=("00000"+e.enquete_id).slice(-5),a=("00000"+e._id).slice(-5),n=(e.question_name,e.question_type,e.site),s=e.input_type,i=e.region,r=e.freeflg,o=e.needs,d=e.ans_string_type,l=e.ans_strings_max,c=(e.unit,e.ans_example||""),u=e.sel_cnt,m=e.is_required,f=e.order,p=e.question_contents;p.forEach(e=>{e.id=("00000"+e.id).slice(-5)});var g=e.question_img,h=e.question_name,e=e.question_type;_.validations[a]={ans_string_type:d,ans_strings_max:l,enquete_id:t,freeflg:r,input_type:s,is_required:m,needs:o,order:f,_id:a,question_name:h,question_type:e,question_contents:p,question_img:g,region:i,sel_cnt:u,site:n,ans_example:c},v.push({ans_string_type:d,ans_strings_max:l,enquete_id:t,freeflg:r,input_type:s,is_required:m,needs:o,order:f,_id:a,question_name:h,question_type:e,question_contents:p,question_img:g,region:i,sel_cnt:u,site:n,ans_example:c})}),s=g("html").attr("lang"),r={title:o,token:BCMS.token,enquete_type:i,_id:d,lng:s,region:r,site:BCMS.site,question:v},g(m).html(g(".js-enq__template").render(r))}}).fail(function(e,t,a){p(_.url.current,"Other")})}),g(document).on("keyup blur",'input[id^="answer"][type="text"]',function(){var e=s(this),t=g(this).attr("id")+"_at";g("#"+t).html(e)}),g(document).on("keyup blur",'textarea[id^="answer"]',function(){var e=s(this),t=g(this).attr("id")+"_at";g("#"+t).html(e)}),g(document).on("change",'input[id^="answer"][type="text"]',function(){var e=s(this),t=g(this).attr("id")+"_at";g("#"+t).html(e)}),g(document).on("click",'input[id^="answer"][type="checkbox"]',function(e){var t=g(this).attr("name"),a=g(this).data("max");""!=a&&"null"!=a&&"0"!=a&&(void 0===a||a<g('input[name="'+t+'"]:checked').length&&e.preventDefault())}),g(document).on("submit",'form[name^="enq_form_"]',function(e){e.preventDefault(),g(this).find('input[type="submit"]').each((e,t)=>{g(t).prop("disabled",!0)});var n={_id:g('[name="_id"]').val(),site:g('[name="site"]').val(),lng:g('[name="lng"]').val(),region:BCMS.site,answer:[]},d=[],l=g('input[name^="answer"][type="checkbox"],input[name^="answer"][type="radio"],input[name^="answer"][type="text"],textarea[id^="answer"]');Object.keys(l).forEach(function(e){var t=l[e],a=""!==t.value?t.value:null,n=Number(g(t).data("question_id"));if(!n)return!1;var s=g(t).data("input_type"),i=null,r=null,o=null;"QUE_FREE"===s?(d[n]&&(r=d[n].que_free_text),a&&((r=null==r?{}:r)[Number(g(t).data("question_value"))]=a)):("text"===s||"textarea"===s||"OTHER_FREE"===s&&""!=a)&&(o=a,i=s),e=null,e=d[n]||{question_id:n,answer:i,que_free_text:r,free_text:o},"checkbox"==s?g(t).prop("checked")&&(null==e.answer&&(e.answer=[]),!1===e.answer.includes(Number(a))&&e.answer.push(Number(a))):"radio"==s?g(t).prop("checked")&&(e.answer=Number(a)):"QUE_FREE"==s&&(e.que_free_text=r),null!=e.answer&&(d[n]=e)}),Object.keys(d).forEach(function(e){e=d[e],n.answer.push(e)});var t=JSON.stringify(n),a=BCMS.api_url,e="?token="+BCMS.token+"&ip="+BCMS.ip+"&site="+BCMS.site;g.ajax({url:a+"/dragonball/Enquete/validate_answer"+e,crossDomain:!0,xhrFields:{withCredentials:!0},type:"POST",dataType:"JSON",cache:!1,scriptCharset:"utf-8",data:t}).done(e=>{var t,a;200===e.statusCode?!1===e.data.apiStatus||"NG"===e.data.validation?i(e.data.errormessage):!0===e.data.apiStatus&&"OK"===e.data.validation&&(t=n,a=e.data.enquete_csrf.name,e=e.data.enquete_csrf.token,t[a]=e,e=location.hostname,e=location.protocol+"//"+e+"/news/enquete_answer/index.php",g.ajax({headers:{"X-CSRF-TOKEN":g('meta[name="csrf-token"]').attr("content")},url:e,xhrFields:{withCredentials:!0},type:"POST",dataType:"JSON",cache:!1,scriptCharset:"utf-8",data:t}).done(e=>!0!==e.apiStatus?e.errormessage?void i(e.errormessage):void p(_.url.current,"Other"):void f("html",null,_.enquete.id)).fail(function(e){})):p(_.url.current,statusCode)}).fail(function(e){p(_.url.current,"Other")})})},g(".js-setEnq").setEnq()}(jQuery);